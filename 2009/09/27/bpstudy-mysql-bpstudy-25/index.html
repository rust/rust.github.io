<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="generator" content="Hugo 0.19-DEV" />

  <title>bpstudy#25に行ってきた &middot; なんとなく日記</title>

  
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/pure-min.css">

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/grids-responsive-old-ie-min.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/grids-responsive-min.css">
  <!--<![endif]-->

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://stnard.jp/css/side-menu-old-ie.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://stnard.jp/css/side-menu.css">
  <!--<![endif]-->

  <link rel="stylesheet" href="https://stnard.jp/css/blackburn.css">

  
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">

  
  <link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet" type="text/css">

  
  

  
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.1.0/styles/androidstudio.min.css">
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.1.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>
  

  <link rel="shortcut icon" href="https://stnard.jp/img/favicon.ico" type="image/x-icon" />

  
    <link rel="stylesheet" href="https://stnard.jp/css/custom.css">
  
  

</head>


<body>
<div id="layout">

  
<a href="#menu" id="menuLink" class="menu-link">
  
  <span></span>
</a>
<div id="menu">

  
  <a class="pure-menu-heading brand" href="https://stnard.jp/">stnard.jp</a>


  <div class="pure-menu">
    <ul class="pure-menu-list">
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://stnard.jp/"><i class='fa fa-home fa-fw'></i>Home</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://blog.stnard.jp"><i class='fa fa-list fa-fw'></i>Blog</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://stnard.jp/post/"><i class='fa fa-list fa-fw'></i>Old Posts</a>
      
        </li>
      
    </ul>
  </div>

  <div class="pure-menu social">
  <ul class="pure-menu-list">

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://twitter.com/conceal_rs" target="_blank"><i class="fa fa-twitter-square fa-fw"></i>Twitter</a>
    </li>
    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://facebook.com/rust.ogawa" target="_blank"><i class="fa fa-facebook-square fa-fw"></i>Facebook</a>
    </li>
    

    

    

    

    

    

    

    

    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="http://slideshare.net/rust" target="_blank"><i class="fa fa-slideshare fa-fw"></i>SlideShare</a>
    </li>
    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://linkedin.com/in/shin-ichiro-ogawa-2711891b" target="_blank"><i class="fa fa-linkedin-square fa-fw"></i>LinkedIn</a>
    </li>
    

    

    

    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://github.com/rust" target="_blank"><i class="fa fa-github-square fa-fw"></i>GitHub</a>
    </li>
    

    

    

    

    

    

    

    

    

    

    

  </ul>
</div>


  <div>
  <div class="small-print">
    <small>&copy; 2016. All rights reserved.</small>
  </div>
  <div class="small-print">
    <small>Built with&nbsp;<a href="https://gohugo.io/" target="_blank">Hugo</a></small>
    <small>Theme&nbsp;<a href="https://github.com/yoshiharuyamashita/blackburn" target="_blank">Blackburn</a></small>
  </div>
</div>

</div>


  <div id="main">


<div class="header">
  <h1>bpstudy#25に行ってきた</h1>
  <h2></h2>
</div>
<div class="content">

  <div class="post-meta">

  <div>
    <i class="fa fa-calendar fa-fw"></i>
    <time>2009/09/27</time>
  </div>

  

  

  

</div>


  <ul>
<li>恵比寿で．やっぱり迷いました・・・・</li>
</ul>

<p>##最初のプレゼン</p>

<ul>
<li>ここ遅刻orz</li>
</ul>

<p>##Scaling?</p>

<ul>
<li>演算速度

<ul>
<li>ムーアの法則で高速化される</li>
</ul></li>
<li>フラッシュメモリ

<ul>
<li>12ヶ月で2倍になってきてる</li>
</ul></li>
<li>HDD

<ul>
<li>2年で倍ぐらいになっている</li>
</ul></li>
<li>インターネット回線

<ul>
<li>高速化されている</li>
</ul></li>
<li>スケールしないものもある

<ul>
<li>HDDのレイテンシ</li>
<li>回転速度は20年で2倍ぐらいにしかならない</li>
<li>インターネットのレイテンシ</li>
<li>東京～サンフランシスコは8300km

<ul>
<li>光の速度 55ms よりは早くならない</li>
</ul></li>
</ul></li>
<li>4Gbps って速いの？

<ul>
<li>スイッチングハブが12Gbps</li>
<li>Perl で書いたHTTPサーバ</li>
<li>10Gbps も出るらしい</li>
<li>HDD からのランダムリード</li>
<li>0.5GB/s -&gt; 2000台いるかも！</li>
</ul></li>
<li>遅いのはHDD

<ul>
<li>RDBMS/ファイルストレージ</li>
<li>SSDは部分的解決策</li>
<li>他に CPU intensive な処理もある</li>
</ul></li>
<li>なぜスケールアウトが流行るのか

<ul>
<li>スケールアウトは 2000 年代のトレンド</li>
<li>パッケージからサービスへ</li>
<li>マスメディア(Yahoo!)からコミュニケーションツールへ(mixi)

<ul>
<li>多人数間の疎なソーシャルグラフ</li>
</ul></li>
<li>従来よりも，スケールアウトしやすくなっている状況</li>
</ul></li>
<li>代表的なスケールアウト技術

<ul>
<li>RDB Shading</li>
<li>MapReduce/Hadoop</li>
<li>KVS(Key Value Store)</li>
<li>Message Queue</li>
</ul></li>
<li>3層構成

<ul>
<li>HTTPサーバ</li>
<li>アプリケーションサーバ</li>
<li>ここにプログラマは注力する</li>
<li>ストレージ</li>
</ul></li>
<li>規模の拡大 vs ムーアの法則

<ul>
<li>スケールアウトにはバランスが重要</li>
</ul></li>
</ul>

<p>##Incline &amp; Pacific</p>

<ul>
<li>大規模ウェブサービスの課題

<ul>
<li>データベースのスケールアウト</li>
<li>一般的には RDBMS のパーティショニング

<ul>
<li>アプリケーションレベルのパーティショニング</li>
<li>id 毎のパーティショニング</li>
</ul></li>
<li>もしくは KVS</li>
</ul></li>
<li>RDBMS のパーティショニング

<ul>
<li>複数の RDBMS サーバの連携</li>
<li>サーバが安いから台数を増やしやすい</li>
<li>問題点</li>
<li>事前の分割設計が難しい</li>
<li>運用開始後の再分割が困難</li>
</ul></li>
<li>分散KVS

<ul>
<li>利点</li>
<li>動的にサーバ追加</li>
<li>高可用性や自動構成など</li>
<li>欠点</li>
<li>RDBMS にしかない機能が使えない

<ul>
<li>Range Query/Transaction/Relation/Secondary Index/etc.</li>
</ul></li>
<li>一貫性が薄い場合がある</li>
<li>データの局所性がない</li>
</ul></li>
<li>CAP 定理

<ul>
<li>Consistensy, Avalability, Partition-tolerance のうち，同時に満たせるのは「２つ」</li>
<li>P2P は Partition-tolerance をあきらめる</li>
<li>データセンター内では？ Partition-tolerance をあきらめる？

<ul>
<li>ネットワークは冗長化できる</li>
<li>ノード舞に HA クラスタを組めたり</li>
</ul></li>
</ul></li>
<li>Incline &amp; Pacific の目指すところ

<ul>
<li>RDBMS と 分散 KVS のいいところ取り</li>
<li>RDBMS の動的パーティショニング技術</li>
<li>Range-based partitioning</li>
<li>関連データの局所化による障害の影響の局所化</li>
<li>SQL による柔軟なクエリ</li>
<li>様々な更新手法</li>
<li>局所的なトランザクション

<ul>
<li>同一ユーザならトランザクションとか</li>
</ul></li>
</ul></li>
<li>Inclune &amp; Pacific は O/R Mapper ではない

<ul>
<li>Include はノード間のデータ同期</li>
<li>strong consistency なら 2 phase commit</li>
<li>Pacific は RDBMS の Shading に専念</li>
</ul></li>
</ul>

<p>##A Clever Way to Slace-out a Web Application</p>

<ul>
<li>RDB shading

<ul>
<li>非正規化は必須になる</li>
<li>相互にアクセスするので，分散されにくい</li>
</ul></li>
<li>shading を update する2つの方法

<ul>
<li>eventual consistensy</li>
<li>worker process を使って非同期更新</li>
<li>高速でスケールしやすいが，維持が大変</li>
<li>2-phase commit</li>
<li>時間がかかる可能性がある</li>
</ul></li>
<li>問題点

<ul>
<li>クエリーが複雑になる</li>
<li>絶えず複数のDBからになる</li>
<li>ノード間の一貫性の維持が大変</li>
<li>動的にスケールすることの複雑さ</li>
</ul></li>
<li>データベースのトリガー

<ul>
<li>SQL のフックとかコールバックとかみたいな</li>
</ul></li>
<li>Incline

<ul>
<li>eventual consistency の2つの問題の解決</li>
<li>複雑なクエリの改善</li>
<li>非正規化テーブルの維持</li>
<li>基本的にはトリガーを使う</li>
</ul></li>
<li>どうやってるのか1

<ul>
<li>同一データベースはそのまま更新</li>
<li>他のデータベースにはキューに入れて，転送プロセスに転送させて実行する</li>
</ul></li>
<li>どうやっているのか2

<ul>
<li>キューには同一トランザクションになっている</li>
<li>キューの転送は fault-tolerant になっている</li>
<li>あくまで非同期処理</li>
<li>eventual consistensy</li>
</ul></li>
<li>details

<ul>
<li>定義ファイルからトリガー生成</li>
<li>同一ノード内ではトリガーで同期</li>
<li>ノード間は daemon が非同期に転送</li>
<li>helper は C++ 製</li>
</ul></li>
<li>Pacific</li>
<li>Range-based shading vs. hash-based

<ul>
<li>Range-based is better</li>
<li>範囲クエリーが使える</li>
<li>手動で分割，追い出し出来る</li>
<li>負荷が高いものを分散できる

<ul>
<li>hash-based は全てのマシンの負荷が同じになる．機材調達に難あり</li>
</ul></li>
</ul></li>
<li>tools

<ul>
<li>mysqld_jumpstart</li>
<li>MySQLのインスタンスをセットアップして起動してくれるツール</li>
<li>daemontools で監視してくれる</li>
<li>master/slave それぞれのセットアップが簡単</li>
<li>slave 作成のためのバックアップもやってくれる

<ul>
<li>hot-backup の XtraBackup を使っている</li>
</ul></li>
<li>pacific_devide</li>
<li>MySQL shard の分割</li>
<li>分割後の問題

<ul>
<li>ダウンタイムを短く</li>
<li>データの整合性を保ちたい</li>
</ul></li>
<li>fail-safe</li>
<li>ダウンタイムを短く

<ul>
<li>10秒以内</li>
</ul></li>
<li>具体的にどうやる？

<ul>
<li>スレーブを作って</li>
<li>ユーザが書き込みできないようにして</li>
<li>同期して</li>
<li>トリガー更新して</li>
<li>新しいユーザ作って</li>
<li>shard 定義を更新して</li>
<li>終わり？</li>
</ul></li>
</ul></li>
<li>DBIx::SHardManager

<ul>
<li>自動設定のリロード</li>
<li>drizzle などで複数同時問い合わせなど</li>
</ul></li>
<li>今後

<ul>
<li>Incline</li>
<li>複数キー on MySQL</li>
<li>データ脳復旧</li>
<li>Pacific 名付けがちょっと混乱するかも</li>
</ul></li>
<li>Q&amp;A

<ul>
<li>複数ノード間の JOIN はやめたほうがいい</li>
<li>分割するときにキューははけて無くてもいい</li>
<li>集計する場合などの解決策は，バッチ処理に逃げるしかないのかなーという印象</li>
<li>キューに入った順に処理されるので，更新は絶えず上書きされるなどで，fault-tolerant を実現</li>
<li>キューが独立して動作するので，完全な Consistency は保証されないが，eventual consistency ではある</li>
<li>いつプロダクションにかは，皆さん次第です！</li>
<li>fail-over をやることは考えてない．DRBD とかを使えばいいんじゃないかと</li>
</ul></li>
</ul>

<p>##デモ</p>

<ul>
<li>master から slave のセットアップはかなり簡単にできる</li>
<li>trigger を使って，面倒な更新がお手軽に</li>
</ul>

<p>##A Better Cached</p>

<ul>
<li>Membached の利点

<ul>
<li>RDB 読み込み負荷低減とスケールアウトするところ</li>
</ul></li>
<li>欠点

<ul>
<li>一貫性維持が面倒</li>
<li>問い合わせが複雑</li>
<li>データがあふれる可能性がある</li>
<li>うっかり session_id と入れるとやばい？</li>
</ul></li>
<li>前提

<ul>
<li>RDBMS がスケールしない -&gt; から，キャッシュを使う</li>
<li>なら Pacific &amp; Incline で</li>
<li>残る派同時接続数</li>
</ul></li>
<li>SQL パーサーを外せば！

<ul>
<li>mycached</li>
<li>mysqld が memcached プロトコルを話す</li>
<li>読み込みのみ</li>
<li>memcached プロトコルを使って，MySQL からデータを取得できる</li>
</ul></li>
<li>デモ</li>
<li>利点とか

<ul>
<li>整合性を気にせずに，高速化される</li>
</ul></li>
<li>問題とか

<ul>
<li>負荷が分散するわけではない</li>
</ul></li>
<li>よりよいアプローチとして

<ul>
<li>App Server と RDBMS の間に入るような構成になればいい</li>
<li>ほんとのキャッシュとして使う</li>
</ul></li>
</ul>

<p>##まとめ</p>

<ul>
<li>懇親会は<strike>怖かったので</strike>マイルのために欠席．</li>
<li>結構色んなクラスタの人が来ていた模様．</li>
<li>次回も参加で(怖くなければ)懇親会にも行きたいなと．</li>
</ul>


  <div class="share-buttons">
    <div class="fb-like" data-href="https://stnard.jp/2009/09/27/bpstudy-mysql-bpstudy-25/" data-layout="button_count" data-action="like" data-size="small" data-show-faces="true" data-share="true"></div>
    <div class="hatena-share-button"><a href="http://b.hatena.ne.jp/entry/" class="hatena-bookmark-button" data-hatena-bookmark-layout="standard-balloon" data-hatena-bookmark-lang="ja" title="このエントリーをはてなブックマークに追加"><img src="https://b.st-hatena.com/images/entry-button/button-only@2x.png" alt="このエントリーをはてなブックマークに追加" width="20" height="20" style="border: none;" /></a><script type="text/javascript" src="https://b.st-hatena.com/js/bookmark_button.js" charset="utf-8" async="async"></script></div>
    <div class="twitter-share-button"><a href="https://twitter.com/share" class="twitter-share-button" data-via="conceal_rs">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script></div>
</div>
<div id="fb-root"></div>
<script>(function(d, s, id) {
     var js, fjs = d.getElementsByTagName(s)[0];
     if (d.getElementById(id)) return;
     js = d.createElement(s); js.id = id;
     js.src = "//connect.facebook.net/ja_KS/sdk.js#xfbml=1&version=v2.8";
     fjs.parentNode.insertBefore(js, fjs);
 }(document, 'script', 'facebook-jssdk'));</script>


  
<div class="prev-next-post pure-g">
  <div class="pure-u-1-24" style="text-align: left;">
    
    <a href="https://stnard.jp/2009/09/17/ruby-mac-Ruby-Mac-OS-X/"><i class="fa fa-chevron-left"></i></a>
    
  </div>
  <div class="pure-u-10-24">
    
    <nav class="prev">
      <a href="https://stnard.jp/2009/09/17/ruby-mac-Ruby-Mac-OS-X/">RubyによるMac OS Xデスクトップアプリケーション開発入門：無料プレゼント企画</a>
    </nav>
    
  </div>
  <div class="pure-u-2-24">
    &nbsp;
  </div>
  <div class="pure-u-10-24">
    
    <nav class="next">
      <a href="https://stnard.jp/2009/09/30/emacs-Emacs-01/">五反田Emacs#01に行ってきた</a>
    </nav>
    
  </div>
  <div class="pure-u-1-24" style="text-align: right;">
    
    <a href="https://stnard.jp/2009/09/30/emacs-Emacs-01/"><i class="fa fa-chevron-right"></i></a>
    
  </div>
</div>



  
<div id="disqus_thread"></div>
<script type="text/javascript">

(function() {
    
    
    if (window.location.hostname == "localhost")
        return;

    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    var disqus_shortname = 'stnardsdiary';
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


</div>

</div>
</div>
<script src="https://stnard.jp/js/ui.js"></script>


<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-33462373-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-33462373-1');
</script>



</body>
</html>

